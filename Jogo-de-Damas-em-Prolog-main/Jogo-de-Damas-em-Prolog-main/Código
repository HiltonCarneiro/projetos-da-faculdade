% RepresentaÃ§Ã£o do tabuleiro como uma matriz 8x8
% Cada cÃ©lula pode conter: vazio (ðŸŸ¨), peÃ§a branca (âšª), peÃ§a preta (âš«), dama branca (ðŸ³), dama preta (ðŸ´).

% InicializaÃ§Ã£o do tabuleiro
inicializa_tabuleiro([
	[âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨],
	[ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«],
	[âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨, âš«, ðŸŸ¨],
	[ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨],
	[ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨, ðŸŸ¨],
	[ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª],
	[âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨],
	[ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª, ðŸŸ¨, âšª]
]).

% FunÃ§Ã£o para exibir o tabuleiro
exibir_linha([]) :- nl.
exibir_linha([H|T]) :- write(H), write(' '), exibir_linha(T).

exibir_tabuleiro(Tabuleiro) :-
	nl, write([' ', '1' , ' ', '2',' ', '3' ,' ', '4' ,' ', '5',' ', '6' ,' ', '7' ,' ', '8']), nl,
	exibir_tabuleiro_aux(Tabuleiro, 1).

exibir_tabuleiro_aux([], _).
exibir_tabuleiro_aux([H|T], N) :-
	write(N), write(' '),
	exibir_linha(H),
	N1 is N + 1,
	exibir_tabuleiro_aux(T, N1).

% Verifica se uma cÃ©lula estÃ¡ vazia
cÃ©lula_vazia(Tabuleiro, (Linha, Coluna)) :-
	nth1(Linha, Tabuleiro, LinhaTab),
	nth1(Coluna, LinhaTab, ðŸŸ¨).

% Verifica se uma peÃ§a Ã© adversÃ¡ria
peÃ§a_adversÃ¡ria(âš«, âšª).
peÃ§a_adversÃ¡ria(âšª, âš«).

% Substitui um valor em uma lista
substituir_linha([_|Resto], 1, Valor, [Valor|Resto]).
substituir_linha([H|Resto], Coluna, Valor, [H|NovoResto]) :-
	Coluna > 1,
	NovaColuna is Coluna - 1,
	substituir_linha(Resto, NovaColuna, Valor, NovoResto).

% Substitui um valor no tabuleiro
substituir([_|Resto], 1, NovaLinha, [NovaLinha|Resto]).
substituir([H|Resto], Linha, NovaLinha, [H|NovoResto]) :-
	Linha > 1,
	NovaLinhaIndex is Linha - 1,
	substituir(Resto, NovaLinhaIndex, NovaLinha, NovoResto).

% Verifica se uma peÃ§a deve ser transformada em dama
transformar_em_dama((Linha, _), PeÃ§a, NovaPeÃ§a) :-
	(PeÃ§a = âšª, Linha = 1 -> NovaPeÃ§a = ðŸ³ ; % PeÃ§a branca na linha 1
 	PeÃ§a = âš«, Linha = 8 -> NovaPeÃ§a = ðŸ´ ; % PeÃ§a preta na linha 8
 	NovaPeÃ§a = PeÃ§a). % Caso contrÃ¡rio, mantÃ©m a peÃ§a

% Movimento simples (modificado para damas se moverem livremente)
movimento_simples(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna), NovoTabuleiro) :-
    % ObtÃ©m a peÃ§a que estÃ¡ se movendo
    nth1(LinhaAtual, Tabuleiro, LinhaTab),
    nth1(ColunaAtual, LinhaTab, PeÃ§a),
    % Verifica se o movimento Ã© vÃ¡lido
    movimento_valido(PeÃ§a, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna),
    % Verifica se o caminho estÃ¡ livre
    caminho_livre(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna)),
    % Verifica se a nova posiÃ§Ã£o estÃ¡ dentro do tabuleiro
    between(1, 8, NovaLinha), between(1, 8, NovaColuna),
    % Verifica se a nova posiÃ§Ã£o estÃ¡ vazia
    cÃ©lula_vazia(Tabuleiro, (NovaLinha, NovaColuna)),
    % ObtÃ©m a peÃ§a que estÃ¡ se movendo
    nth1(LinhaAtual, Tabuleiro, LinhaTab),
    nth1(ColunaAtual, LinhaTab, PeÃ§a),
    % Verifica se a peÃ§a estÃ¡ se movendo corretamente
    movimento_valido(PeÃ§a, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna),
    % Verifica se o caminho estÃ¡ livre
    caminho_livre(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna)),
    % Verifica se a peÃ§a deve ser transformada em dama
	transformar_em_dama((NovaLinha, NovaColuna), PeÃ§a, NovaPeÃ§a),
    % Atualiza o tabuleiro
    substituir_linha(LinhaTab, ColunaAtual, ðŸŸ¨, NovaLinhaTab),
    substituir(Tabuleiro, LinhaAtual, NovaLinhaTab, TabuleiroTemp),
    nth1(NovaLinha, TabuleiroTemp, LinhaTabNova),
    substituir_linha(LinhaTabNova, NovaColuna, NovaPeÃ§a, NovaLinhaTabNova),
    substituir(TabuleiroTemp, NovaLinha, NovaLinhaTabNova, NovoTabuleiro).

% Define regras de movimento para cada tipo de peÃ§a
movimento_valido(âšª, LinhaAtual, NovaLinha, _, _) :- NovaLinha is LinhaAtual - 1.
movimento_valido(âš«, LinhaAtual, NovaLinha, _, _) :- NovaLinha is LinhaAtual + 1.
movimento_valido(ðŸ³, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna) :-
    abs(NovaLinha - LinhaAtual) =:= abs(NovaColuna - ColunaAtual).
movimento_valido(ðŸ´, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna) :-
    abs(NovaLinha - LinhaAtual) =:= abs(NovaColuna - ColunaAtual).  % Branco sÃ³ sobe
movimento_valido(âš«, LinhaAtual, NovaLinha, _, _) :- NovaLinha is LinhaAtual + 1.  % Preto sÃ³ desce
movimento_valido(ðŸ³, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna) :-
    abs(NovaLinha - LinhaAtual) =:= abs(NovaColuna - ColunaAtual). % Movimento diagonal
movimento_valido(ðŸ´, LinhaAtual, NovaLinha, ColunaAtual, NovaColuna) :-
    abs(NovaLinha - LinhaAtual) =:= abs(NovaColuna - ColunaAtual). % Movimento diagonal

% Verifica se o caminho entre (LinhaAtual, ColunaAtual) e (NovaLinha, NovaColuna) estÃ¡ livre
caminho_livre(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna)) :-
    LinhaDif is sign(NovaLinha - LinhaAtual),
    ColunaDif is sign(NovaColuna - ColunaAtual),
    caminho_vazio(Tabuleiro, LinhaAtual, ColunaAtual, LinhaDif, ColunaDif, NovaLinha, NovaColuna),
    LinhaDif is sign(NovaLinha - LinhaAtual),
    ColunaDif is sign(NovaColuna - ColunaAtual),
    caminho_vazio(Tabuleiro, LinhaAtual, ColunaAtual, LinhaDif, ColunaDif, NovaLinha, NovaColuna).

caminho_vazio(_, Linha, Coluna, _, _, Linha, Coluna).
caminho_vazio(Tabuleiro, Linha, Coluna, LinhaDif, ColunaDif, DestLinha, DestColuna) :-
    LinhaProx is Linha + LinhaDif,
    ColunaProx is Coluna + ColunaDif,
    cÃ©lula_vazia(Tabuleiro, (LinhaProx, ColunaProx)),
    caminho_vazio(Tabuleiro, LinhaProx, ColunaProx, LinhaDif, ColunaDif, DestLinha, DestColuna).
% Movimento com captura
movimento_captura(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna), NovoTabuleiro) :-
	% Verifica se a nova posiÃ§Ã£o estÃ¡ dentro do tabuleiro
between(1, 8, NovaLinha), between(1, 8, NovaColuna),
% Calcula a posiÃ§Ã£o intermediÃ¡ria (peÃ§a adversÃ¡ria)
LinhaIntermediÃ¡ria is (LinhaAtual + NovaLinha) // 2,
ColunaIntermediÃ¡ria is (ColunaAtual + NovaColuna) // 2,
	% Calcula a posiÃ§Ã£o intermediÃ¡ria (peÃ§a adversÃ¡ria)
	LinhaIntermediÃ¡ria is (LinhaAtual + NovaLinha) // 2,
	ColunaIntermediÃ¡ria is (ColunaAtual + NovaColuna) // 2,
	% Verifica se hÃ¡ uma peÃ§a adversÃ¡ria na posiÃ§Ã£o intermediÃ¡ria
	nth1(LinhaIntermediÃ¡ria, Tabuleiro, LinhaTab),
	nth1(ColunaIntermediÃ¡ria, LinhaTab, PeÃ§aAdversÃ¡ria),
	peÃ§a_adversÃ¡ria(PeÃ§a, PeÃ§aAdversÃ¡ria),
	% Verifica se a nova posiÃ§Ã£o estÃ¡ vazia
	cÃ©lula_vazia(Tabuleiro, (NovaLinha, NovaColuna)),
	% ObtÃ©m a peÃ§a que estÃ¡ se movendo
	nth1(LinhaAtual, Tabuleiro, LinhaTabAtual),
	nth1(ColunaAtual, LinhaTabAtual, PeÃ§a),
	% Verifica se a peÃ§a deve ser transformada em dama
	transformar_em_dama((NovaLinha, NovaColuna), PeÃ§a, NovaPeÃ§a),
	% Atualiza o tabuleiro
	substituir_linha(LinhaTabAtual, ColunaAtual, ðŸŸ¨, NovaLinhaTabAtual),
	substituir(Tabuleiro, LinhaAtual, NovaLinhaTabAtual, TabuleiroTemp1),
	nth1(LinhaIntermediÃ¡ria, TabuleiroTemp1, LinhaTabIntermediÃ¡ria),
	substituir_linha(LinhaTabIntermediÃ¡ria, ColunaIntermediÃ¡ria, ðŸŸ¨, NovaLinhaTabIntermediÃ¡ria),
	substituir(TabuleiroTemp1, LinhaIntermediÃ¡ria, NovaLinhaTabIntermediÃ¡ria, TabuleiroTemp2),
	nth1(NovaLinha, TabuleiroTemp2, LinhaTabNova),
	substituir_linha(LinhaTabNova, NovaColuna, NovaPeÃ§a, NovaLinhaTabNova),
	substituir(TabuleiroTemp2, NovaLinha, NovaLinhaTabNova, NovoTabuleiro).

% LÃª a entrada do jogador
ler_entrada(Mensagem, (Linha, Coluna)) :-
	write(Mensagem), nl,
	write('Linha: '), read(Linha),
	write('Coluna: '), read(Coluna).

% Loop principal do jogo
jogar :-
	inicializa_tabuleiro(Tabuleiro),
	jogar(Tabuleiro, âš«). % ComeÃ§a com as peÃ§as pretas

jogar(Tabuleiro, Jogador) :-
    exibir_tabuleiro(Tabuleiro),
    write('Vez do jogador: '), write(Jogador), nl,
    ler_entrada('Escolha a peÃ§a para mover (linha, coluna):', (LinhaAtual, ColunaAtual)),
    ler_entrada('Escolha a posiÃ§Ã£o de destino (linha, coluna):', (NovaLinha, NovaColuna)),
    (
        movimento_simples(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna), NovoTabuleiro) ->
        ProximoJogador = (Jogador = âš« -> âšª ; âš«),
        jogar(NovoTabuleiro, ProximoJogador)
    ;
        movimento_captura(Tabuleiro, (LinhaAtual, ColunaAtual), (NovaLinha, NovaColuna), NovoTabuleiro) ->
        ProximoJogador = (Jogador = âš« -> âšª ; âš«),
        jogar(NovoTabuleiro, ProximoJogador)
    ;
        write('Jogada invÃ¡lida! Tente novamente.'), nl,
        jogar(Tabuleiro, Jogador)
    ).

% Inicia o jogo
iniciar :-
	write('Bem-vindo ao Jogo de Damas!'), nl,
	write('As peÃ§as pretas (âš«) comeÃ§am.'), nl,
	jogar.
